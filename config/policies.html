<!DOCTYPE html><html lang="en"><head><title>config/policies</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="config/policies"><meta name="groc-project-path" content="config/policies.js"><meta name="groc-github-url" content="https://github.com/natgeo/activitystreams"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/natgeo/activitystreams/blob/master/config/policies.js">config/policies.js</a></div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><p>Policy mappings (ACL)</p>

<p>Policies are simply Express middleware functions which run <strong>before</strong> your controllers.
You can apply one or more policies to a given controller, or protect just one of its actions.</p>

<p>Any policy file (e.g. <code>authenticated.js</code>) can be dropped into the <code>/policies</code> folder,
at which point it can be accessed below by its filename, minus the extension, (e.g. <code>authenticated</code>)</p>

<p>For more information on policies, check out:
http://sailsjs.org/#documentation</p></div></div><div class="code"><div class="wrapper"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">policies</span> <span class="o">=</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Default policy for all controllers and actions
(<code>true</code> allows public access)</p></div></div><div class="code"><div class="wrapper">  <span class="s1">&#39;*&#39;</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>

  <span class="nx">ActivityController</span><span class="o">:</span> <span class="p">{</span>
      <span class="s1">&#39;*&#39;</span><span class="o">:</span> <span class="s1">&#39;isSanitized&#39;</span><span class="p">,</span>
      <span class="nx">postSpecificActivity</span><span class="o">:</span>  <span class="p">[</span><span class="s1">&#39;isSanitized&#39;</span><span class="p">,</span> <span class="s1">&#39;isAuthenticated&#39;</span><span class="p">],</span>
      <span class="nx">deleteSpecificActivity</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;isSanitized&#39;</span><span class="p">,</span><span class="s1">&#39;isAuthenticated&#39;</span><span class="p">]</span>
  <span class="p">},</span>

  <span class="nx">ActorController</span><span class="o">:</span> <span class="p">{</span>
      <span class="s1">&#39;*&#39;</span><span class="o">:</span> <span class="s1">&#39;isSanitized&#39;</span><span class="p">,</span>
      <span class="nx">deleteSpecificActor</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;isSanitized&#39;</span><span class="p">,</span> <span class="s1">&#39;isAuthenticated&#39;</span><span class="p">]</span>
   <span class="p">},</span>

  <span class="nx">ObjectController</span><span class="o">:</span> <span class="p">{</span>
       <span class="s1">&#39;*&#39;</span><span class="o">:</span> <span class="s1">&#39;isSanitized&#39;</span><span class="p">,</span>
        <span class="nx">deleteSpecificObject</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;isSanitized&#39;</span><span class="p">,</span> <span class="s1">&#39;isAuthenticated&#39;</span><span class="p">]</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><pre><code>// Here's an example of adding some policies to a controller
RabbitController: {

    // Apply the `false` policy as the default for all of RabbitController's actions
    // (`false` prevents all access, which ensures that nothing bad happens to our rabbits)
    '*': false,

    // For the action `nurture`, apply the 'isRabbitMother' policy
    // (this overrides `false` above)
    nurture : 'isRabbitMother',

    // Apply the `isNiceToAnimals` AND `hasRabbitFood` policies
    // before letting any users feed our rabbits
    feed : ['isNiceToAnimals', 'hasRabbitFood']
}
</code></pre></div></div><div class="code"><div class="wrapper"><span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Here's what the <code>isNiceToAnimals</code> policy from above might look like:
(this file would be located at <code>policies/isNiceToAnimals.js</code>)</p>

<p>We'll make some educated guesses about whether our system will
consider this user someone who is nice to animals.</p>

<p>Besides protecting rabbits (while a noble cause, no doubt),
here are a few other example use cases for policies:</p>

<ul>
<li>cookie-based authentication</li>
<li>role-based access control</li>
<li>limiting file uploads based on MB quotas</li>
<li>OAuth</li>
<li>BasicAuth</li>
<li>or any other kind of authentication scheme you can imagine</li>
</ul></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>module.exports = function isNiceToAnimals (req, res, next) {</p>

<pre><code>// `req.session` contains a set of data specific to the user making this request.
// It's kind of like our app's "memory" of the current user.

// If our user has a history of animal cruelty, not only will we
// prevent her from going even one step further (`return`),
// we'll go ahead and redirect her to PETA (`res.redirect`).
if ( req.session.user.hasHistoryOfAnimalCruelty ) {
    return res.redirect('http://PETA.org');
}

// If the user has been seen frowning at puppies, we have to assume that
// they might end up being mean to them, so we'll
if ( req.session.user.frownsAtPuppies ) {
    return res.redirect('http://www.dailypuppy.com/');
}

// Finally, if the user has a clean record, we'll call the `next()` function
// to let them through to the next policy or our controller
next();
</code></pre>

<p>};</p></div></div></div></div></body></html>